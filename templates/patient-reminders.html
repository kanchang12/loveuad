<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Reminders</title>
    <style>
        *{margin:0;padding:0;box-sizing:border-box;}
        body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;background:#f5f5f5;padding:20px;}
        .header{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:white;padding:20px;border-radius:15px;margin-bottom:20px;}
        h1{font-size:24px;}
        .reminder-card{background:white;padding:20px;border-radius:15px;margin-bottom:15px;box-shadow:0 2px 8px rgba(0,0,0,0.1);display:flex;justify-content:space-between;align-items:center;}
        .reminder-info{flex:1;}
        .reminder-med{font-size:18px;font-weight:600;color:#333;margin-bottom:5px;}
        .reminder-time{color:#667eea;font-size:16px;font-weight:500;}
        .take-btn{padding:12px 24px;background:#4CAF50;color:white;border:none;border-radius:10px;cursor:pointer;font-size:14px;}
        .take-btn:disabled{background:#ccc;cursor:not-allowed;}
        .taken-badge{background:#4CAF50;color:white;padding:8px 16px;border-radius:10px;font-size:14px;}
        .back-btn{display:inline-block;padding:12px 24px;background:white;color:#667eea;text-decoration:none;border-radius:10px;margin-top:20px;}
    </style>
</head>
<body>
    <div class="header"><h1>⏰ Today's Reminders</h1></div>
    <div id="remindersList"></div>
    <a href="/patient-dashboard.html" class="back-btn">← Back to Dashboard</a>
    <script>
        const API_BASE=window.location.origin;
        const codeHash=localStorage.getItem('patientCodeHash');
        async function loadReminders(){
            if(!codeHash){window.location.href='/patient-login.html';return;}
            try{
                const response=await fetch(`${API_BASE}/api/medications/${codeHash}`);
                const data=await response.json();
                const container=document.getElementById('remindersList');
                const reminders=[];
                if(data.success&&data.medications.length>0){
                    data.medications.forEach(med=>{
                        med.times.forEach(time=>{
                            const taken=med.takenStatus&&med.takenStatus[time];
                            reminders.push({medication:med.name,time:time,dosage:med.dosage,taken:taken});
                        });
                    });
                    reminders.sort((a,b)=>a.time.localeCompare(b.time));
                    container.innerHTML=reminders.map((r,idx)=>`
                        <div class="reminder-card">
                            <div class="reminder-info">
                                <div class="reminder-med">${r.medication}</div>
                                <div class="reminder-time">⏰ ${r.time} - ${r.dosage}</div>
                            </div>
                            ${r.taken?'<span class="taken-badge">✓ Taken</span>':`<button class="take-btn" onclick="markTaken('${r.medication}','${r.time}',${idx})">Mark Taken</button>`}
                        </div>
                    `).join('');
                }else{
                    container.innerHTML='<div style="text-align:center;padding:40px;color:#999;">No reminders for today</div>';
                }
            }catch(error){
                console.error('Error loading reminders:',error);
            }
        }
        async function markTaken(medication,time,idx){
            try{
                const response=await fetch(`${API_BASE}/api/health/medication-taken`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({codeHash:codeHash,medicationName:medication,scheduledTime:time,takenAt:new Date().toISOString()})});
                if(response.ok){loadReminders();}
            }catch(error){
                console.error('Error marking taken:',error);
            }
        }
        loadReminders();
    </script>
</body>
</html>