<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Analytics - loveUAD</title>
    <style>
        *{margin:0;padding:0;box-sizing:border-box;}
        body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;background:#f5f5f5;padding:20px;}
        .header{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:white;padding:20px;border-radius:15px;margin-bottom:20px;}
        h1{font-size:28px;}
        .stats-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:15px;margin-bottom:20px;}
        .stat-card{background:white;padding:20px;border-radius:15px;box-shadow:0 2px 8px rgba(0,0,0,0.1);}
        .stat-value{font-size:32px;font-weight:bold;color:#667eea;margin-bottom:5px;}
        .stat-label{color:#666;font-size:14px;}
        .chart-container{background:white;padding:20px;border-radius:15px;margin-bottom:20px;}
        #loginForm{background:white;padding:40px;border-radius:15px;max-width:400px;margin:100px auto;}
        .input-group{margin-bottom:20px;}
        label{display:block;margin-bottom:8px;color:#333;font-weight:500;}
        input{width:100%;padding:12px;border:2px solid #e0e0e0;border-radius:8px;font-size:16px;}
        .btn{width:100%;padding:14px;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:white;border:none;border-radius:8px;font-size:16px;font-weight:600;cursor:pointer;}
        #dashboardView{display:none;}
    </style>
</head>
<body>
    <div id="loginForm">
        <h1 style="color:#667eea;margin-bottom:20px;">Admin Login</h1>
        <div class="input-group">
            <label>Password</label>
            <input type="password" id="password" placeholder="Enter admin password">
        </div>
        <button onclick="login()" class="btn">Login</button>
        <p id="error" style="color:red;margin-top:10px;display:none;"></p>
    </div>
    <div id="dashboardView">
        <div class="header"><h1>ðŸ“Š Admin Analytics Dashboard</h1></div>
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-value" id="totalPatients">-</div>
                <div class="stat-label">Total Patients</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="activeUsers">-</div>
                <div class="stat-label">Active Users (7d)</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="totalMeds">-</div>
                <div class="stat-label">Medications</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="surveyResponses">-</div>
                <div class="stat-label">Survey Responses</div>
            </div>
        </div>
        <div class="chart-container">
            <h2>Daily Active Users</h2>
            <div id="dauChart">Loading...</div>
        </div>
    </div>
    <script>
        const API_BASE=window.location.origin;
        async function login(){
            const password=document.getElementById('password').value;
            try{
                const response=await fetch(`${API_BASE}/api/admin/verify-password`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({password})});
                const data=await response.json();
                if(data.success){
                    document.getElementById('loginForm').style.display='none';
                    document.getElementById('dashboardView').style.display='block';
                    loadDashboard();
                }else{
                    document.getElementById('error').textContent='Invalid password';
                    document.getElementById('error').style.display='block';
                }
            }catch(error){
                document.getElementById('error').textContent='Login failed';
                document.getElementById('error').style.display='block';
            }
        }
        async function loadDashboard(){
            try{
                const response=await fetch(`${API_BASE}/api/admin/dashboard-stats`);
                const data=await response.json();
                if(data.success){
                    document.getElementById('totalPatients').textContent=data.stats.accounts.total_patients;
                    document.getElementById('activeUsers').textContent=data.stats.accounts.active_users;
                    document.getElementById('totalMeds').textContent=data.stats.accounts.total_medications;
                    document.getElementById('surveyResponses').textContent=data.stats.survey.total_responses;
                }
            }catch(error){
                console.error('Failed to load dashboard:',error);
            }
        }
    </script>
</body>
</html>
